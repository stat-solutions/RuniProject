/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, ViewContainerRef, ComponentFactoryResolver, Input, Output, EventEmitter, Renderer2, ChangeDetectorRef, Inject, ElementRef } from '@angular/core';
import { Placements, Triggers } from './popper-model';
import { PopperContent } from './popper-content';
export class PopperController {
    /**
     * @param {?} viewContainerRef
     * @param {?} changeDetectorRef
     * @param {?} resolver
     * @param {?} elementRef
     * @param {?} renderer
     * @param {?=} popperDefaults
     */
    constructor(viewContainerRef, changeDetectorRef, resolver, elementRef, renderer, popperDefaults = {}) {
        this.viewContainerRef = viewContainerRef;
        this.changeDetectorRef = changeDetectorRef;
        this.resolver = resolver;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.popperDefaults = popperDefaults;
        this.popperContentClass = PopperContent;
        this.shown = false;
        this.subscriptions = [];
        this.eventListeners = [];
        this.globalEventListeners = [];
        this.hideTimeout = 0;
        this.timeoutAfterShow = 0;
        this.popperOnShown = new EventEmitter();
        this.popperOnHidden = new EventEmitter();
        this.popperOnUpdate = new EventEmitter();
        PopperController.baseOptions = Object.assign({}, PopperController.baseOptions, this.popperDefaults);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    hideOnClickOutsideHandler($event) {
        if (this.disabled || !this.hideOnClickOutside || $event.srcElement &&
            $event.srcElement === this.popperContent.elemRef.nativeElement ||
            this.popperContent.elemRef.nativeElement.contains($event.srcElement)) {
            return;
        }
        this.scheduledHide($event, this.hideTimeout);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    hideOnScrollHandler($event) {
        if (this.disabled || !this.hideOnScroll) {
            return;
        }
        this.scheduledHide($event, this.hideTimeout);
    }
    /**
     * @return {?}
     */
    applyTriggerListeners() {
        switch (this.showTrigger) {
            case Triggers.CLICK:
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'click', this.toggle.bind(this)));
                break;
            case Triggers.MOUSEDOWN:
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'mousedown', this.toggle.bind(this)));
                break;
            case Triggers.HOVER:
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'mouseenter', this.scheduledShow.bind(this, this.showDelay)));
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'touchend', this.scheduledHide.bind(this, null, this.hideTimeout)));
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'touchcancel', this.scheduledHide.bind(this, null, this.hideTimeout)));
                this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'mouseleave', this.scheduledHide.bind(this, null, this.hideTimeout)));
                break;
        }
        if (this.showTrigger !== Triggers.HOVER && this.hideOnMouseLeave) {
            this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'touchend', this.scheduledHide.bind(this, null, this.hideTimeout)));
            this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'touchcancel', this.scheduledHide.bind(this, null, this.hideTimeout)));
            this.eventListeners.push(this.renderer.listen(this.elementRef.nativeElement, 'mouseleave', this.scheduledHide.bind(this, null, this.hideTimeout)));
        }
    }
    /**
     * @param {?} target
     * @param {...?} sources
     * @return {?}
     */
    static assignDefined(target, ...sources) {
        for (const source of sources) {
            for (const key of Object.keys(source)) {
                /** @type {?} */
                const val = source[key];
                if (val !== undefined) {
                    target[key] = val;
                }
            }
        }
        return target;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        //Support legacy prop
        this.hideOnClickOutside = typeof this.hideOnClickOutside === 'undefined' ?
            this.closeOnClickOutside : this.hideOnClickOutside;
        if (typeof this.content === 'string') {
            /** @type {?} */
            const text = this.content;
            this.popperContent = this.constructContent();
            this.popperContent.text = text;
        }
        else {
            this.popperContent = this.content;
        }
        /** @type {?} */
        const popperRef = this.popperContent;
        popperRef.referenceObject = this.getRefElement();
        this.setContentProperties(popperRef);
        this.setDefaults();
        this.applyTriggerListeners();
        if (this.showOnStart) {
            this.scheduledShow();
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes['popperDisabled'] && changes['popperDisabled'].currentValue) {
            this.hide();
        }
        if (changes['content']
            && !changes['content'].firstChange
            && typeof changes['content'].currentValue === 'string') {
            this.popperContent.text = changes['content'].currentValue;
        }
        if (changes['applyClass']
            && !changes['applyClass'].firstChange
            && typeof changes['applyClass'].currentValue === 'string') {
            this.popperContent.popperOptions.applyClass = changes['applyClass'].currentValue;
        }
        if (changes['applyArrowClass']
            && !changes['applyArrowClass'].firstChange
            && typeof changes['applyArrowClass'].currentValue === 'string') {
            this.popperContent.popperOptions.applyArrowClass = changes['applyArrowClass'].currentValue;
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscriptions.forEach(sub => sub.unsubscribe && sub.unsubscribe());
        this.subscriptions.length = 0;
        this.clearEventListeners();
        this.clearGlobalEventListeners();
        clearTimeout(this.scheduledShowTimeout);
        clearTimeout(this.scheduledHideTimeout);
        this.popperContent && this.popperContent.clean();
    }
    /**
     * @return {?}
     */
    toggle() {
        if (this.disabled) {
            return;
        }
        this.shown ? this.scheduledHide(null, this.hideTimeout) : this.scheduledShow();
    }
    /**
     * @return {?}
     */
    show() {
        if (this.shown) {
            this.overrideHideTimeout();
            return;
        }
        this.shown = true;
        /** @type {?} */
        const popperRef = this.popperContent;
        /** @type {?} */
        const element = this.getRefElement();
        if (popperRef.referenceObject !== element) {
            popperRef.referenceObject = element;
        }
        this.setContentProperties(popperRef);
        popperRef.show();
        this.popperOnShown.emit(this);
        if (this.timeoutAfterShow > 0) {
            this.scheduledHide(null, this.timeoutAfterShow);
        }
        this.globalEventListeners.push(this.renderer.listen('document', 'touchend', this.hideOnClickOutsideHandler.bind(this)));
        this.globalEventListeners.push(this.renderer.listen('document', 'click', this.hideOnClickOutsideHandler.bind(this)));
        this.globalEventListeners.push(this.renderer.listen(this.getScrollParent(this.getRefElement()), 'scroll', this.hideOnScrollHandler.bind(this)));
    }
    /**
     * @return {?}
     */
    hide() {
        if (this.disabled) {
            return;
        }
        if (!this.shown) {
            this.overrideShowTimeout();
            return;
        }
        this.shown = false;
        if (this.popperContentRef) {
            this.popperContentRef.instance.hide();
        }
        else {
            this.popperContent.hide();
        }
        this.popperOnHidden.emit(this);
        this.clearGlobalEventListeners();
    }
    /**
     * @param {?=} delay
     * @return {?}
     */
    scheduledShow(delay = this.showDelay) {
        if (this.disabled) {
            return;
        }
        this.overrideHideTimeout();
        this.scheduledShowTimeout = setTimeout(() => {
            this.show();
            this.applyChanges();
        }, delay);
    }
    /**
     * @param {?=} $event
     * @param {?=} delay
     * @return {?}
     */
    scheduledHide($event = null, delay = this.hideTimeout) {
        if (this.disabled) {
            return;
        }
        this.overrideShowTimeout();
        this.scheduledHideTimeout = setTimeout(() => {
            /** @type {?} */
            const toElement = $event ? $event.toElement : null;
            /** @type {?} */
            const popperContentView = this.popperContent.popperViewRef ? this.popperContent.popperViewRef.nativeElement : false;
            if (!popperContentView || popperContentView === toElement || popperContentView.contains(toElement) || ((/** @type {?} */ (this.content))).isMouseOver) {
                return;
            }
            this.hide();
            this.applyChanges();
        }, delay);
    }
    /**
     * @return {?}
     */
    getRefElement() {
        return this.targetElement || this.viewContainerRef.element.nativeElement;
    }
    /**
     * @private
     * @return {?}
     */
    applyChanges() {
        this.changeDetectorRef.markForCheck();
        this.changeDetectorRef.detectChanges();
    }
    /**
     * @private
     * @return {?}
     */
    setDefaults() {
        this.showDelay = typeof this.showDelay === 'undefined' ? PopperController.baseOptions.showDelay : this.showDelay;
        this.showTrigger = typeof this.showTrigger === 'undefined' ? PopperController.baseOptions.trigger : this.showTrigger;
        this.hideOnClickOutside = typeof this.hideOnClickOutside === 'undefined' ? PopperController.baseOptions.hideOnClickOutside : this.hideOnClickOutside;
        this.hideOnScroll = typeof this.hideOnScroll === 'undefined' ? PopperController.baseOptions.hideOnScroll : this.hideOnScroll;
        this.hideOnMouseLeave = typeof this.hideOnMouseLeave === 'undefined' ? PopperController.baseOptions.hideOnMouseLeave : this.hideOnMouseLeave;
        this.ariaRole = typeof this.ariaRole === 'undefined' ? PopperController.baseOptions.ariaRole : this.ariaRole;
        this.ariaDescribe = typeof this.ariaDescribe === 'undefined' ? PopperController.baseOptions.ariaDescribe : this.ariaDescribe;
        this.styles = typeof this.styles === 'undefined' ? Object.assign({}, PopperController.baseOptions.styles) : this.styles;
    }
    /**
     * @private
     * @return {?}
     */
    clearEventListeners() {
        this.eventListeners.forEach(evt => {
            evt && typeof evt === 'function' && evt();
        });
        this.eventListeners.length = 0;
    }
    /**
     * @private
     * @return {?}
     */
    clearGlobalEventListeners() {
        this.globalEventListeners.forEach(evt => {
            evt && typeof evt === 'function' && evt();
        });
        this.globalEventListeners.length = 0;
    }
    /**
     * @private
     * @return {?}
     */
    overrideShowTimeout() {
        if (this.scheduledShowTimeout) {
            clearTimeout(this.scheduledShowTimeout);
            this.scheduledHideTimeout = 0;
        }
    }
    /**
     * @private
     * @return {?}
     */
    overrideHideTimeout() {
        if (this.scheduledHideTimeout) {
            clearTimeout(this.scheduledHideTimeout);
            this.scheduledHideTimeout = 0;
        }
    }
    /**
     * @private
     * @return {?}
     */
    constructContent() {
        /** @type {?} */
        const factory = this.resolver.resolveComponentFactory(this.popperContentClass);
        this.popperContentRef = this.viewContainerRef.createComponent(factory);
        return (/** @type {?} */ (this.popperContentRef.instance));
    }
    /**
     * @private
     * @param {?} popperRef
     * @return {?}
     */
    setContentProperties(popperRef) {
        popperRef.popperOptions = PopperController.assignDefined(popperRef.popperOptions, PopperController.baseOptions, {
            showDelay: this.showDelay,
            disableAnimation: this.disableAnimation,
            disableDefaultStyling: this.disableStyle,
            placement: this.placement,
            boundariesElement: this.boundariesElement,
            trigger: this.showTrigger,
            positionFixed: this.positionFixed,
            popperModifiers: this.popperModifiers,
            ariaDescribe: this.ariaDescribe,
            ariaRole: this.ariaRole,
            applyClass: this.applyClass,
            applyArrowClass: this.applyArrowClass,
            hideOnMouseLeave: this.hideOnMouseLeave,
            styles: this.styles,
            appendTo: this.appendTo,
            preventOverflow: this.preventOverflow,
        });
        popperRef.onUpdate = this.onPopperUpdate.bind(this);
        this.subscriptions.push(popperRef.onHidden.subscribe(this.hide.bind(this)));
    }
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    getScrollParent(node) {
        /** @type {?} */
        const isElement = node instanceof HTMLElement;
        /** @type {?} */
        const overflowY = isElement && window.getComputedStyle(node).overflowY;
        /** @type {?} */
        const isScrollable = overflowY !== 'visible' && overflowY !== 'hidden';
        if (!node) {
            return null;
        }
        else if (isScrollable && node.scrollHeight >= node.clientHeight) {
            return node;
        }
        return this.getScrollParent(node.parentNode) || document;
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onPopperUpdate(event) {
        this.popperOnUpdate.emit(event);
    }
}
PopperController.baseOptions = (/** @type {?} */ ({
    showDelay: 0,
    placement: Placements.Auto,
    hideOnClickOutside: true,
    hideOnMouseLeave: false,
    hideOnScroll: false,
    showTrigger: Triggers.HOVER,
    appendTo: undefined,
    ariaRole: 'popper',
    ariaDescribe: '',
    styles: {}
}));
PopperController.decorators = [
    { type: Directive, args: [{
                selector: '[popper]',
                exportAs: 'popper'
            },] }
];
/** @nocollapse */
PopperController.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: ChangeDetectorRef },
    { type: ComponentFactoryResolver },
    { type: ElementRef },
    { type: Renderer2 },
    { type: undefined, decorators: [{ type: Inject, args: ['popperDefaults',] }] }
];
PopperController.propDecorators = {
    content: [{ type: Input, args: ['popper',] }],
    disabled: [{ type: Input, args: ['popperDisabled',] }],
    placement: [{ type: Input, args: ['popperPlacement',] }],
    showTrigger: [{ type: Input, args: ['popperTrigger',] }],
    targetElement: [{ type: Input, args: ['popperTarget',] }],
    showDelay: [{ type: Input, args: ['popperDelay',] }],
    hideTimeout: [{ type: Input, args: ['popperTimeout',] }],
    timeoutAfterShow: [{ type: Input, args: ['popperTimeoutAfterShow',] }],
    boundariesElement: [{ type: Input, args: ['popperBoundaries',] }],
    showOnStart: [{ type: Input, args: ['popperShowOnStart',] }],
    closeOnClickOutside: [{ type: Input, args: ['popperCloseOnClickOutside',] }],
    hideOnClickOutside: [{ type: Input, args: ['popperHideOnClickOutside',] }],
    hideOnScroll: [{ type: Input, args: ['popperHideOnScroll',] }],
    hideOnMouseLeave: [{ type: Input, args: ['popperHideOnMouseLeave',] }],
    positionFixed: [{ type: Input, args: ['popperPositionFixed',] }],
    popperModifiers: [{ type: Input, args: ['popperModifiers',] }],
    disableStyle: [{ type: Input, args: ['popperDisableStyle',] }],
    disableAnimation: [{ type: Input, args: ['popperDisableAnimation',] }],
    applyClass: [{ type: Input, args: ['popperApplyClass',] }],
    applyArrowClass: [{ type: Input, args: ['popperApplyArrowClass',] }],
    ariaDescribe: [{ type: Input, args: ['popperAriaDescribeBy',] }],
    ariaRole: [{ type: Input, args: ['popperAriaRole',] }],
    styles: [{ type: Input, args: ['popperStyles',] }],
    appendTo: [{ type: Input, args: ['popperAppendTo',] }],
    preventOverflow: [{ type: Input, args: ['popperPreventOverflow',] }],
    popperOnShown: [{ type: Output }],
    popperOnHidden: [{ type: Output }],
    popperOnUpdate: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    PopperController.baseOptions;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.popperContentClass;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.popperContentRef;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.shown;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.scheduledShowTimeout;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.scheduledHideTimeout;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.eventListeners;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.globalEventListeners;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.popperContent;
    /** @type {?} */
    PopperController.prototype.content;
    /** @type {?} */
    PopperController.prototype.disabled;
    /** @type {?} */
    PopperController.prototype.placement;
    /** @type {?} */
    PopperController.prototype.showTrigger;
    /** @type {?} */
    PopperController.prototype.targetElement;
    /** @type {?} */
    PopperController.prototype.showDelay;
    /** @type {?} */
    PopperController.prototype.hideTimeout;
    /** @type {?} */
    PopperController.prototype.timeoutAfterShow;
    /** @type {?} */
    PopperController.prototype.boundariesElement;
    /** @type {?} */
    PopperController.prototype.showOnStart;
    /** @type {?} */
    PopperController.prototype.closeOnClickOutside;
    /** @type {?} */
    PopperController.prototype.hideOnClickOutside;
    /** @type {?} */
    PopperController.prototype.hideOnScroll;
    /** @type {?} */
    PopperController.prototype.hideOnMouseLeave;
    /** @type {?} */
    PopperController.prototype.positionFixed;
    /** @type {?} */
    PopperController.prototype.popperModifiers;
    /** @type {?} */
    PopperController.prototype.disableStyle;
    /** @type {?} */
    PopperController.prototype.disableAnimation;
    /** @type {?} */
    PopperController.prototype.applyClass;
    /** @type {?} */
    PopperController.prototype.applyArrowClass;
    /** @type {?} */
    PopperController.prototype.ariaDescribe;
    /** @type {?} */
    PopperController.prototype.ariaRole;
    /** @type {?} */
    PopperController.prototype.styles;
    /** @type {?} */
    PopperController.prototype.appendTo;
    /** @type {?} */
    PopperController.prototype.preventOverflow;
    /** @type {?} */
    PopperController.prototype.popperOnShown;
    /** @type {?} */
    PopperController.prototype.popperOnHidden;
    /** @type {?} */
    PopperController.prototype.popperOnUpdate;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.viewContainerRef;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.resolver;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PopperController.prototype.popperDefaults;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wcGVyLWRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1wb3BwZXIvIiwic291cmNlcyI6WyJzcmMvcG9wcGVyLWRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxnQkFBZ0IsRUFDaEIsd0JBQXdCLEVBQ3hCLEtBQUssRUFHTCxNQUFNLEVBRU4sWUFBWSxFQUFVLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUN2RSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQVksVUFBVSxFQUFpQyxRQUFRLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5RixPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sa0JBQWtCLENBQUM7QUFNL0MsTUFBTSxPQUFPLGdCQUFnQjs7Ozs7Ozs7O0lBVzNCLFlBQW9CLGdCQUFrQyxFQUNsQyxpQkFBb0MsRUFDcEMsUUFBa0MsRUFDbEMsVUFBc0IsRUFDdEIsUUFBbUIsRUFDTyxpQkFBdUMsRUFBRTtRQUxuRSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFDbEMsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ08sbUJBQWMsR0FBZCxjQUFjLENBQTJCO1FBZi9FLHVCQUFrQixHQUFHLGFBQWEsQ0FBQztRQUVuQyxVQUFLLEdBQVksS0FBSyxDQUFDO1FBR3ZCLGtCQUFhLEdBQVUsRUFBRSxDQUFDO1FBQzFCLG1CQUFjLEdBQVUsRUFBRSxDQUFDO1FBQzNCLHlCQUFvQixHQUFVLEVBQUUsQ0FBQztRQTRDekMsZ0JBQVcsR0FBVyxDQUFDLENBQUM7UUFHeEIscUJBQWdCLEdBQVcsQ0FBQyxDQUFDO1FBc0Q3QixrQkFBYSxHQUFtQyxJQUFJLFlBQVksRUFBb0IsQ0FBQztRQUdyRixt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QkFBdUI7MkJBRzdCLEtBQUssU0FBQyxzQkFBc0I7dUJBRzVCLEtBQUssU0FBQyxnQkFBZ0I7cUJBR3RCLEtBQUssU0FBQyxjQUFjO3VCQUdwQixLQUFLLFNBQUMsZ0JBQWdCOzhCQUd0QixLQUFLLFNBQUMsdUJBQXVCOzRCQUc3QixNQUFNOzZCQUdOLE1BQU07NkJBR04sTUFBTTs7OztJQTlGUCw2QkFXRTs7Ozs7SUE5QkYsOENBQTJDOzs7OztJQUMzQyw0Q0FBc0Q7Ozs7O0lBQ3RELGlDQUErQjs7Ozs7SUFDL0IsZ0RBQWtDOzs7OztJQUNsQyxnREFBa0M7Ozs7O0lBQ2xDLHlDQUFrQzs7Ozs7SUFDbEMsMENBQW1DOzs7OztJQUNuQyxnREFBeUM7Ozs7O0lBQ3pDLHlDQUFxQzs7SUF3QnJDLG1DQUNnQzs7SUFFaEMsb0NBQ2tCOztJQUVsQixxQ0FDcUI7O0lBRXJCLHVDQUNpQzs7SUFFakMseUNBQzJCOztJQUUzQixxQ0FDOEI7O0lBRTlCLHVDQUN3Qjs7SUFFeEIsNENBQzZCOztJQUU3Qiw2Q0FDMEI7O0lBRTFCLHVDQUNxQjs7SUFFckIsK0NBQzZCOztJQUU3Qiw4Q0FDd0M7O0lBRXhDLHdDQUNrQzs7SUFFbEMsNENBQ3NDOztJQUV0Qyx5Q0FDdUI7O0lBRXZCLDJDQUNvQjs7SUFFcEIsd0NBQ3NCOztJQUV0Qiw0Q0FDMEI7O0lBRTFCLHNDQUNtQjs7SUFFbkIsMkNBQ3dCOztJQUV4Qix3Q0FDaUM7O0lBRWpDLG9DQUM2Qjs7SUFFN0Isa0NBQzJCOztJQUUzQixvQ0FDaUI7O0lBRWpCLDJDQUN5Qjs7SUFFekIseUNBQ3FGOztJQUVyRiwwQ0FDc0Y7O0lBRXRGLDBDQUM0RDs7Ozs7SUF4R2hELDRDQUEwQzs7Ozs7SUFDMUMsNkNBQTRDOzs7OztJQUM1QyxvQ0FBMEM7Ozs7O0lBQzFDLHNDQUE4Qjs7Ozs7SUFDOUIsb0NBQTJCOzs7OztJQUMzQiwwQ0FBMkUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIENvbXBvbmVudFJlZixcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBJbnB1dCxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2UsXG4gIE91dHB1dCxcbiAgT25EZXN0cm95LFxuICBFdmVudEVtaXR0ZXIsIE9uSW5pdCwgUmVuZGVyZXIyLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0LCBFbGVtZW50UmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtQbGFjZW1lbnQsIFBsYWNlbWVudHMsIFBvcHBlckNvbnRlbnRPcHRpb25zLCBUcmlnZ2VyLCBUcmlnZ2Vyc30gZnJvbSAnLi9wb3BwZXItbW9kZWwnO1xuaW1wb3J0IHtQb3BwZXJDb250ZW50fSBmcm9tICcuL3BvcHBlci1jb250ZW50JztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3BvcHBlcl0nLFxuICBleHBvcnRBczogJ3BvcHBlcidcbn0pXG5leHBvcnQgY2xhc3MgUG9wcGVyQ29udHJvbGxlciBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuICBwcml2YXRlIHBvcHBlckNvbnRlbnRDbGFzcyA9IFBvcHBlckNvbnRlbnQ7XG4gIHByaXZhdGUgcG9wcGVyQ29udGVudFJlZjogQ29tcG9uZW50UmVmPFBvcHBlckNvbnRlbnQ+O1xuICBwcml2YXRlIHNob3duOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgc2NoZWR1bGVkU2hvd1RpbWVvdXQ6IGFueTtcbiAgcHJpdmF0ZSBzY2hlZHVsZWRIaWRlVGltZW91dDogYW55O1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IGFueVtdID0gW107XG4gIHByaXZhdGUgZXZlbnRMaXN0ZW5lcnM6IGFueVtdID0gW107XG4gIHByaXZhdGUgZ2xvYmFsRXZlbnRMaXN0ZW5lcnM6IGFueVtdID0gW107XG4gIHByaXZhdGUgcG9wcGVyQ29udGVudDogUG9wcGVyQ29udGVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgICAgICAgICAgIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgICAgICAgICAgICBASW5qZWN0KCdwb3BwZXJEZWZhdWx0cycpIHByaXZhdGUgcG9wcGVyRGVmYXVsdHM6IFBvcHBlckNvbnRlbnRPcHRpb25zID0ge30pIHtcbiAgICBQb3BwZXJDb250cm9sbGVyLmJhc2VPcHRpb25zID0gey4uLlBvcHBlckNvbnRyb2xsZXIuYmFzZU9wdGlvbnMsIC4uLnRoaXMucG9wcGVyRGVmYXVsdHN9O1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBiYXNlT3B0aW9uczogUG9wcGVyQ29udGVudE9wdGlvbnMgPSA8UG9wcGVyQ29udGVudE9wdGlvbnM+e1xuICAgIHNob3dEZWxheTogMCxcbiAgICBwbGFjZW1lbnQ6IFBsYWNlbWVudHMuQXV0byxcbiAgICBoaWRlT25DbGlja091dHNpZGU6IHRydWUsXG4gICAgaGlkZU9uTW91c2VMZWF2ZTogZmFsc2UsXG4gICAgaGlkZU9uU2Nyb2xsOiBmYWxzZSxcbiAgICBzaG93VHJpZ2dlcjogVHJpZ2dlcnMuSE9WRVIsXG4gICAgYXBwZW5kVG86IHVuZGVmaW5lZCxcbiAgICBhcmlhUm9sZTogJ3BvcHBlcicsXG4gICAgYXJpYURlc2NyaWJlOiAnJyxcbiAgICBzdHlsZXM6IHt9XG4gIH07XG5cbiAgQElucHV0KCdwb3BwZXInKVxuICBjb250ZW50OiBzdHJpbmcgfCBQb3BwZXJDb250ZW50O1xuXG4gIEBJbnB1dCgncG9wcGVyRGlzYWJsZWQnKVxuICBkaXNhYmxlZDogYm9vbGVhbjtcblxuICBASW5wdXQoJ3BvcHBlclBsYWNlbWVudCcpXG4gIHBsYWNlbWVudDogUGxhY2VtZW50O1xuXG4gIEBJbnB1dCgncG9wcGVyVHJpZ2dlcicpXG4gIHNob3dUcmlnZ2VyOiBUcmlnZ2VyIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgncG9wcGVyVGFyZ2V0JylcbiAgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQ7XG5cbiAgQElucHV0KCdwb3BwZXJEZWxheScpXG4gIHNob3dEZWxheTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgncG9wcGVyVGltZW91dCcpXG4gIGhpZGVUaW1lb3V0OiBudW1iZXIgPSAwO1xuXG4gIEBJbnB1dCgncG9wcGVyVGltZW91dEFmdGVyU2hvdycpXG4gIHRpbWVvdXRBZnRlclNob3c6IG51bWJlciA9IDA7XG5cbiAgQElucHV0KCdwb3BwZXJCb3VuZGFyaWVzJylcbiAgYm91bmRhcmllc0VsZW1lbnQ6IHN0cmluZztcblxuICBASW5wdXQoJ3BvcHBlclNob3dPblN0YXJ0JylcbiAgc2hvd09uU3RhcnQ6IGJvb2xlYW47XG5cbiAgQElucHV0KCdwb3BwZXJDbG9zZU9uQ2xpY2tPdXRzaWRlJylcbiAgY2xvc2VPbkNsaWNrT3V0c2lkZTogYm9vbGVhbjtcblxuICBASW5wdXQoJ3BvcHBlckhpZGVPbkNsaWNrT3V0c2lkZScpXG4gIGhpZGVPbkNsaWNrT3V0c2lkZTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcblxuICBASW5wdXQoJ3BvcHBlckhpZGVPblNjcm9sbCcpXG4gIGhpZGVPblNjcm9sbDogYm9vbGVhbiB8IHVuZGVmaW5lZDtcblxuICBASW5wdXQoJ3BvcHBlckhpZGVPbk1vdXNlTGVhdmUnKVxuICBoaWRlT25Nb3VzZUxlYXZlOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgncG9wcGVyUG9zaXRpb25GaXhlZCcpXG4gIHBvc2l0aW9uRml4ZWQ6IGJvb2xlYW47XG5cbiAgQElucHV0KCdwb3BwZXJNb2RpZmllcnMnKVxuICBwb3BwZXJNb2RpZmllcnM6IHt9O1xuXG4gIEBJbnB1dCgncG9wcGVyRGlzYWJsZVN0eWxlJylcbiAgZGlzYWJsZVN0eWxlOiBib29sZWFuO1xuXG4gIEBJbnB1dCgncG9wcGVyRGlzYWJsZUFuaW1hdGlvbicpXG4gIGRpc2FibGVBbmltYXRpb246IGJvb2xlYW47XG5cbiAgQElucHV0KCdwb3BwZXJBcHBseUNsYXNzJylcbiAgYXBwbHlDbGFzczogc3RyaW5nO1xuXG4gIEBJbnB1dCgncG9wcGVyQXBwbHlBcnJvd0NsYXNzJylcbiAgYXBwbHlBcnJvd0NsYXNzOiBzdHJpbmc7XG5cbiAgQElucHV0KCdwb3BwZXJBcmlhRGVzY3JpYmVCeScpXG4gIGFyaWFEZXNjcmliZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgncG9wcGVyQXJpYVJvbGUnKVxuICBhcmlhUm9sZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gIEBJbnB1dCgncG9wcGVyU3R5bGVzJylcbiAgc3R5bGVzOiBPYmplY3QgfCB1bmRlZmluZWQ7XG5cbiAgQElucHV0KCdwb3BwZXJBcHBlbmRUbycpXG4gIGFwcGVuZFRvOiBzdHJpbmc7XG5cbiAgQElucHV0KCdwb3BwZXJQcmV2ZW50T3ZlcmZsb3cnKVxuICBwcmV2ZW50T3ZlcmZsb3c6IGJvb2xlYW47XG5cbiAgQE91dHB1dCgpXG4gIHBvcHBlck9uU2hvd246IEV2ZW50RW1pdHRlcjxQb3BwZXJDb250cm9sbGVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8UG9wcGVyQ29udHJvbGxlcj4oKTtcblxuICBAT3V0cHV0KClcbiAgcG9wcGVyT25IaWRkZW46IEV2ZW50RW1pdHRlcjxQb3BwZXJDb250cm9sbGVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8UG9wcGVyQ29udHJvbGxlcj4oKTtcblxuICBAT3V0cHV0KClcbiAgcG9wcGVyT25VcGRhdGU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgaGlkZU9uQ2xpY2tPdXRzaWRlSGFuZGxlcigkZXZlbnQ6IE1vdXNlRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCB8fCAhdGhpcy5oaWRlT25DbGlja091dHNpZGUgfHwgJGV2ZW50LnNyY0VsZW1lbnQgJiZcbiAgICAgICRldmVudC5zcmNFbGVtZW50ID09PSB0aGlzLnBvcHBlckNvbnRlbnQuZWxlbVJlZi5uYXRpdmVFbGVtZW50IHx8XG4gICAgICB0aGlzLnBvcHBlckNvbnRlbnQuZWxlbVJlZi5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKCRldmVudC5zcmNFbGVtZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNjaGVkdWxlZEhpZGUoJGV2ZW50LCB0aGlzLmhpZGVUaW1lb3V0KTtcbiAgfVxuXG4gIGhpZGVPblNjcm9sbEhhbmRsZXIoJGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQgfHwgIXRoaXMuaGlkZU9uU2Nyb2xsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2NoZWR1bGVkSGlkZSgkZXZlbnQsIHRoaXMuaGlkZVRpbWVvdXQpO1xuICB9XG5cbiAgYXBwbHlUcmlnZ2VyTGlzdGVuZXJzKCkge1xuICAgIHN3aXRjaCAodGhpcy5zaG93VHJpZ2dlcikge1xuICAgICAgY2FzZSBUcmlnZ2Vycy5DTElDSzpcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAnY2xpY2snLCB0aGlzLnRvZ2dsZS5iaW5kKHRoaXMpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUcmlnZ2Vycy5NT1VTRURPV046XG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ21vdXNlZG93bicsIHRoaXMudG9nZ2xlLmJpbmQodGhpcykpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFRyaWdnZXJzLkhPVkVSOlxuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2godGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWVudGVyJywgdGhpcy5zY2hlZHVsZWRTaG93LmJpbmQodGhpcywgdGhpcy5zaG93RGVsYXkpKSk7XG4gICAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ3RvdWNoZW5kJywgdGhpcy5zY2hlZHVsZWRIaWRlLmJpbmQodGhpcywgbnVsbCwgdGhpcy5oaWRlVGltZW91dCkpKTtcbiAgICAgICAgdGhpcy5ldmVudExpc3RlbmVycy5wdXNoKHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCAndG91Y2hjYW5jZWwnLCB0aGlzLnNjaGVkdWxlZEhpZGUuYmluZCh0aGlzLCBudWxsLCB0aGlzLmhpZGVUaW1lb3V0KSkpO1xuICAgICAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLnB1c2godGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdtb3VzZWxlYXZlJywgdGhpcy5zY2hlZHVsZWRIaWRlLmJpbmQodGhpcywgbnVsbCwgdGhpcy5oaWRlVGltZW91dCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmICh0aGlzLnNob3dUcmlnZ2VyICE9PSBUcmlnZ2Vycy5IT1ZFUiAmJiB0aGlzLmhpZGVPbk1vdXNlTGVhdmUpIHtcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ3RvdWNoZW5kJywgdGhpcy5zY2hlZHVsZWRIaWRlLmJpbmQodGhpcywgbnVsbCwgdGhpcy5oaWRlVGltZW91dCkpKTtcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ3RvdWNoY2FuY2VsJywgdGhpcy5zY2hlZHVsZWRIaWRlLmJpbmQodGhpcywgbnVsbCwgdGhpcy5oaWRlVGltZW91dCkpKTtcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgJ21vdXNlbGVhdmUnLCB0aGlzLnNjaGVkdWxlZEhpZGUuYmluZCh0aGlzLCBudWxsLCB0aGlzLmhpZGVUaW1lb3V0KSkpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBhc3NpZ25EZWZpbmVkKHRhcmdldDogYW55LCAuLi5zb3VyY2VzOiBhbnlbXSkge1xuICAgIGZvciAoY29uc3Qgc291cmNlIG9mIHNvdXJjZXMpIHtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHNvdXJjZSkpIHtcbiAgICAgICAgY29uc3QgdmFsID0gc291cmNlW2tleV07XG4gICAgICAgIGlmICh2YWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXQ7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvL1N1cHBvcnQgbGVnYWN5IHByb3BcbiAgICB0aGlzLmhpZGVPbkNsaWNrT3V0c2lkZSA9IHR5cGVvZiB0aGlzLmhpZGVPbkNsaWNrT3V0c2lkZSA9PT0gJ3VuZGVmaW5lZCcgP1xuICAgICAgdGhpcy5jbG9zZU9uQ2xpY2tPdXRzaWRlIDogdGhpcy5oaWRlT25DbGlja091dHNpZGU7XG5cbiAgICBpZiAodHlwZW9mIHRoaXMuY29udGVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IHRleHQgPSB0aGlzLmNvbnRlbnQ7XG4gICAgICB0aGlzLnBvcHBlckNvbnRlbnQgPSB0aGlzLmNvbnN0cnVjdENvbnRlbnQoKTtcbiAgICAgIHRoaXMucG9wcGVyQ29udGVudC50ZXh0ID0gdGV4dDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnBvcHBlckNvbnRlbnQgPSB0aGlzLmNvbnRlbnQ7XG4gICAgfVxuICAgIGNvbnN0IHBvcHBlclJlZiA9IHRoaXMucG9wcGVyQ29udGVudDtcbiAgICBwb3BwZXJSZWYucmVmZXJlbmNlT2JqZWN0ID0gdGhpcy5nZXRSZWZFbGVtZW50KCk7XG4gICAgdGhpcy5zZXRDb250ZW50UHJvcGVydGllcyhwb3BwZXJSZWYpO1xuICAgIHRoaXMuc2V0RGVmYXVsdHMoKTtcbiAgICB0aGlzLmFwcGx5VHJpZ2dlckxpc3RlbmVycygpO1xuICAgIGlmICh0aGlzLnNob3dPblN0YXJ0KSB7XG4gICAgICB0aGlzLnNjaGVkdWxlZFNob3coKTtcbiAgICB9XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiB7IFtwcm9wZXJ0eU5hbWU6IHN0cmluZ106IFNpbXBsZUNoYW5nZSB9KSB7XG4gICAgaWYgKGNoYW5nZXNbJ3BvcHBlckRpc2FibGVkJ10gJiYgY2hhbmdlc1sncG9wcGVyRGlzYWJsZWQnXS5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuaGlkZSgpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlc1snY29udGVudCddXG4gICAgICAmJiAhY2hhbmdlc1snY29udGVudCddLmZpcnN0Q2hhbmdlXG4gICAgICAmJiB0eXBlb2YgY2hhbmdlc1snY29udGVudCddLmN1cnJlbnRWYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRoaXMucG9wcGVyQ29udGVudC50ZXh0ID0gY2hhbmdlc1snY29udGVudCddLmN1cnJlbnRWYWx1ZTtcbiAgICB9XG5cbiAgICBpZiAoY2hhbmdlc1snYXBwbHlDbGFzcyddXG4gICAgICAmJiAhY2hhbmdlc1snYXBwbHlDbGFzcyddLmZpcnN0Q2hhbmdlXG4gICAgICAmJiB0eXBlb2YgY2hhbmdlc1snYXBwbHlDbGFzcyddLmN1cnJlbnRWYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRoaXMucG9wcGVyQ29udGVudC5wb3BwZXJPcHRpb25zLmFwcGx5Q2xhc3MgPSBjaGFuZ2VzWydhcHBseUNsYXNzJ10uY3VycmVudFZhbHVlO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VzWydhcHBseUFycm93Q2xhc3MnXVxuICAgICAgJiYgIWNoYW5nZXNbJ2FwcGx5QXJyb3dDbGFzcyddLmZpcnN0Q2hhbmdlXG4gICAgICAmJiB0eXBlb2YgY2hhbmdlc1snYXBwbHlBcnJvd0NsYXNzJ10uY3VycmVudFZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5wb3BwZXJDb250ZW50LnBvcHBlck9wdGlvbnMuYXBwbHlBcnJvd0NsYXNzID0gY2hhbmdlc1snYXBwbHlBcnJvd0NsYXNzJ10uY3VycmVudFZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YiA9PiBzdWIudW5zdWJzY3JpYmUgJiYgc3ViLnVuc3Vic2NyaWJlKCkpO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggPSAwO1xuICAgIHRoaXMuY2xlYXJFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuY2xlYXJHbG9iYWxFdmVudExpc3RlbmVycygpO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnNjaGVkdWxlZFNob3dUaW1lb3V0KTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5zY2hlZHVsZWRIaWRlVGltZW91dCk7XG4gICAgdGhpcy5wb3BwZXJDb250ZW50ICYmIHRoaXMucG9wcGVyQ29udGVudC5jbGVhbigpO1xuICB9XG5cbiAgdG9nZ2xlKCkge1xuICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc2hvd24gPyB0aGlzLnNjaGVkdWxlZEhpZGUobnVsbCwgdGhpcy5oaWRlVGltZW91dCkgOiB0aGlzLnNjaGVkdWxlZFNob3coKTtcbiAgfVxuXG4gIHNob3coKSB7XG4gICAgaWYgKHRoaXMuc2hvd24pIHtcbiAgICAgIHRoaXMub3ZlcnJpZGVIaWRlVGltZW91dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd24gPSB0cnVlO1xuICAgIGNvbnN0IHBvcHBlclJlZiA9IHRoaXMucG9wcGVyQ29udGVudDtcbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5nZXRSZWZFbGVtZW50KCk7XG4gICAgaWYgKHBvcHBlclJlZi5yZWZlcmVuY2VPYmplY3QgIT09IGVsZW1lbnQpIHtcbiAgICAgIHBvcHBlclJlZi5yZWZlcmVuY2VPYmplY3QgPSBlbGVtZW50O1xuICAgIH1cbiAgICB0aGlzLnNldENvbnRlbnRQcm9wZXJ0aWVzKHBvcHBlclJlZik7XG4gICAgcG9wcGVyUmVmLnNob3coKTtcbiAgICB0aGlzLnBvcHBlck9uU2hvd24uZW1pdCh0aGlzKTtcbiAgICBpZiAodGhpcy50aW1lb3V0QWZ0ZXJTaG93ID4gMCkge1xuICAgICAgdGhpcy5zY2hlZHVsZWRIaWRlKG51bGwsIHRoaXMudGltZW91dEFmdGVyU2hvdyk7XG4gICAgfVxuICAgIHRoaXMuZ2xvYmFsRXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAndG91Y2hlbmQnLCB0aGlzLmhpZGVPbkNsaWNrT3V0c2lkZUhhbmRsZXIuYmluZCh0aGlzKSkpO1xuICAgIHRoaXMuZ2xvYmFsRXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3RlbignZG9jdW1lbnQnLCAnY2xpY2snLCB0aGlzLmhpZGVPbkNsaWNrT3V0c2lkZUhhbmRsZXIuYmluZCh0aGlzKSkpO1xuICAgIHRoaXMuZ2xvYmFsRXZlbnRMaXN0ZW5lcnMucHVzaCh0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmdldFNjcm9sbFBhcmVudCh0aGlzLmdldFJlZkVsZW1lbnQoKSksICdzY3JvbGwnLCB0aGlzLmhpZGVPblNjcm9sbEhhbmRsZXIuYmluZCh0aGlzKSkpO1xuICB9XG5cbiAgaGlkZSgpIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc2hvd24pIHtcbiAgICAgIHRoaXMub3ZlcnJpZGVTaG93VGltZW91dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuc2hvd24gPSBmYWxzZTtcbiAgICBpZiAodGhpcy5wb3BwZXJDb250ZW50UmVmKSB7XG4gICAgICB0aGlzLnBvcHBlckNvbnRlbnRSZWYuaW5zdGFuY2UuaGlkZSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMucG9wcGVyQ29udGVudC5oaWRlKCk7XG4gICAgfVxuICAgIHRoaXMucG9wcGVyT25IaWRkZW4uZW1pdCh0aGlzKTtcbiAgICB0aGlzLmNsZWFyR2xvYmFsRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHNjaGVkdWxlZFNob3coZGVsYXk6IG51bWJlciB8IHVuZGVmaW5lZCA9IHRoaXMuc2hvd0RlbGF5KSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5vdmVycmlkZUhpZGVUaW1lb3V0KCk7XG4gICAgdGhpcy5zY2hlZHVsZWRTaG93VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5zaG93KCk7XG4gICAgICB0aGlzLmFwcGx5Q2hhbmdlcygpO1xuICAgIH0sIGRlbGF5KVxuICB9XG5cbiAgc2NoZWR1bGVkSGlkZSgkZXZlbnQ6IGFueSA9IG51bGwsIGRlbGF5OiBudW1iZXIgPSB0aGlzLmhpZGVUaW1lb3V0KSB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5vdmVycmlkZVNob3dUaW1lb3V0KCk7XG4gICAgdGhpcy5zY2hlZHVsZWRIaWRlVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3QgdG9FbGVtZW50ID0gJGV2ZW50ID8gJGV2ZW50LnRvRWxlbWVudCA6IG51bGw7XG4gICAgICBjb25zdCBwb3BwZXJDb250ZW50VmlldyA9IHRoaXMucG9wcGVyQ29udGVudC5wb3BwZXJWaWV3UmVmID8gdGhpcy5wb3BwZXJDb250ZW50LnBvcHBlclZpZXdSZWYubmF0aXZlRWxlbWVudCA6IGZhbHNlO1xuICAgICAgaWYgKCFwb3BwZXJDb250ZW50VmlldyB8fCBwb3BwZXJDb250ZW50VmlldyA9PT0gdG9FbGVtZW50IHx8IHBvcHBlckNvbnRlbnRWaWV3LmNvbnRhaW5zKHRvRWxlbWVudCkgfHwgKHRoaXMuY29udGVudCBhcyBQb3BwZXJDb250ZW50KS5pc01vdXNlT3Zlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIHRoaXMuYXBwbHlDaGFuZ2VzKCk7XG4gICAgfSwgZGVsYXkpO1xuICB9XG5cbiAgZ2V0UmVmRWxlbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXRFbGVtZW50IHx8IHRoaXMudmlld0NvbnRhaW5lclJlZi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBwcml2YXRlIGFwcGx5Q2hhbmdlcygpIHtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXREZWZhdWx0cygpIHtcbiAgICB0aGlzLnNob3dEZWxheSA9IHR5cGVvZiB0aGlzLnNob3dEZWxheSA9PT0gJ3VuZGVmaW5lZCcgPyBQb3BwZXJDb250cm9sbGVyLmJhc2VPcHRpb25zLnNob3dEZWxheSA6IHRoaXMuc2hvd0RlbGF5O1xuICAgIHRoaXMuc2hvd1RyaWdnZXIgPSB0eXBlb2YgdGhpcy5zaG93VHJpZ2dlciA9PT0gJ3VuZGVmaW5lZCcgPyBQb3BwZXJDb250cm9sbGVyLmJhc2VPcHRpb25zLnRyaWdnZXIgOiB0aGlzLnNob3dUcmlnZ2VyO1xuICAgIHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlID0gdHlwZW9mIHRoaXMuaGlkZU9uQ2xpY2tPdXRzaWRlID09PSAndW5kZWZpbmVkJyA/IFBvcHBlckNvbnRyb2xsZXIuYmFzZU9wdGlvbnMuaGlkZU9uQ2xpY2tPdXRzaWRlIDogdGhpcy5oaWRlT25DbGlja091dHNpZGU7XG4gICAgdGhpcy5oaWRlT25TY3JvbGwgPSB0eXBlb2YgdGhpcy5oaWRlT25TY3JvbGwgPT09ICd1bmRlZmluZWQnID8gUG9wcGVyQ29udHJvbGxlci5iYXNlT3B0aW9ucy5oaWRlT25TY3JvbGwgOiB0aGlzLmhpZGVPblNjcm9sbDtcbiAgICB0aGlzLmhpZGVPbk1vdXNlTGVhdmUgPSB0eXBlb2YgdGhpcy5oaWRlT25Nb3VzZUxlYXZlID09PSAndW5kZWZpbmVkJyA/IFBvcHBlckNvbnRyb2xsZXIuYmFzZU9wdGlvbnMuaGlkZU9uTW91c2VMZWF2ZSA6IHRoaXMuaGlkZU9uTW91c2VMZWF2ZTtcbiAgICB0aGlzLmFyaWFSb2xlID0gdHlwZW9mIHRoaXMuYXJpYVJvbGUgPT09ICd1bmRlZmluZWQnID8gUG9wcGVyQ29udHJvbGxlci5iYXNlT3B0aW9ucy5hcmlhUm9sZSA6IHRoaXMuYXJpYVJvbGU7XG4gICAgdGhpcy5hcmlhRGVzY3JpYmUgPSB0eXBlb2YgdGhpcy5hcmlhRGVzY3JpYmUgPT09ICd1bmRlZmluZWQnID8gUG9wcGVyQ29udHJvbGxlci5iYXNlT3B0aW9ucy5hcmlhRGVzY3JpYmUgOiB0aGlzLmFyaWFEZXNjcmliZTtcbiAgICB0aGlzLnN0eWxlcyA9IHR5cGVvZiB0aGlzLnN0eWxlcyA9PT0gJ3VuZGVmaW5lZCcgPyBPYmplY3QuYXNzaWduKHt9LCBQb3BwZXJDb250cm9sbGVyLmJhc2VPcHRpb25zLnN0eWxlcykgOiB0aGlzLnN0eWxlcztcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLmV2ZW50TGlzdGVuZXJzLmZvckVhY2goZXZ0ID0+IHtcbiAgICAgIGV2dCAmJiB0eXBlb2YgZXZ0ID09PSAnZnVuY3Rpb24nICYmIGV2dCgpO1xuICAgIH0pO1xuICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnMubGVuZ3RoID0gMDtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJHbG9iYWxFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLmdsb2JhbEV2ZW50TGlzdGVuZXJzLmZvckVhY2goZXZ0ID0+IHtcbiAgICAgIGV2dCAmJiB0eXBlb2YgZXZ0ID09PSAnZnVuY3Rpb24nICYmIGV2dCgpO1xuICAgIH0pO1xuICAgIHRoaXMuZ2xvYmFsRXZlbnRMaXN0ZW5lcnMubGVuZ3RoID0gMDtcbiAgfVxuXG4gIHByaXZhdGUgb3ZlcnJpZGVTaG93VGltZW91dCgpIHtcbiAgICBpZiAodGhpcy5zY2hlZHVsZWRTaG93VGltZW91dCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2NoZWR1bGVkU2hvd1RpbWVvdXQpO1xuICAgICAgdGhpcy5zY2hlZHVsZWRIaWRlVGltZW91dCA9IDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvdmVycmlkZUhpZGVUaW1lb3V0KCkge1xuICAgIGlmICh0aGlzLnNjaGVkdWxlZEhpZGVUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zY2hlZHVsZWRIaWRlVGltZW91dCk7XG4gICAgICB0aGlzLnNjaGVkdWxlZEhpZGVUaW1lb3V0ID0gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdENvbnRlbnQoKTogUG9wcGVyQ29udGVudCB7XG4gICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkodGhpcy5wb3BwZXJDb250ZW50Q2xhc3MpO1xuICAgIHRoaXMucG9wcGVyQ29udGVudFJlZiA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XG4gICAgcmV0dXJuIHRoaXMucG9wcGVyQ29udGVudFJlZi5pbnN0YW5jZSBhcyBQb3BwZXJDb250ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb250ZW50UHJvcGVydGllcyhwb3BwZXJSZWY6IFBvcHBlckNvbnRlbnQpIHtcbiAgICBwb3BwZXJSZWYucG9wcGVyT3B0aW9ucyA9IFBvcHBlckNvbnRyb2xsZXIuYXNzaWduRGVmaW5lZChwb3BwZXJSZWYucG9wcGVyT3B0aW9ucywgUG9wcGVyQ29udHJvbGxlci5iYXNlT3B0aW9ucywge1xuICAgICAgc2hvd0RlbGF5OiB0aGlzLnNob3dEZWxheSxcbiAgICAgIGRpc2FibGVBbmltYXRpb246IHRoaXMuZGlzYWJsZUFuaW1hdGlvbixcbiAgICAgIGRpc2FibGVEZWZhdWx0U3R5bGluZzogdGhpcy5kaXNhYmxlU3R5bGUsXG4gICAgICBwbGFjZW1lbnQ6IHRoaXMucGxhY2VtZW50LFxuICAgICAgYm91bmRhcmllc0VsZW1lbnQ6IHRoaXMuYm91bmRhcmllc0VsZW1lbnQsXG4gICAgICB0cmlnZ2VyOiB0aGlzLnNob3dUcmlnZ2VyLFxuICAgICAgcG9zaXRpb25GaXhlZDogdGhpcy5wb3NpdGlvbkZpeGVkLFxuICAgICAgcG9wcGVyTW9kaWZpZXJzOiB0aGlzLnBvcHBlck1vZGlmaWVycyxcbiAgICAgIGFyaWFEZXNjcmliZTogdGhpcy5hcmlhRGVzY3JpYmUsXG4gICAgICBhcmlhUm9sZTogdGhpcy5hcmlhUm9sZSxcbiAgICAgIGFwcGx5Q2xhc3M6IHRoaXMuYXBwbHlDbGFzcyxcbiAgICAgIGFwcGx5QXJyb3dDbGFzczogdGhpcy5hcHBseUFycm93Q2xhc3MsXG4gICAgICBoaWRlT25Nb3VzZUxlYXZlOiB0aGlzLmhpZGVPbk1vdXNlTGVhdmUsXG4gICAgICBzdHlsZXM6IHRoaXMuc3R5bGVzLFxuICAgICAgYXBwZW5kVG86IHRoaXMuYXBwZW5kVG8sXG4gICAgICBwcmV2ZW50T3ZlcmZsb3c6IHRoaXMucHJldmVudE92ZXJmbG93LFxuICAgIH0pO1xuICAgIHBvcHBlclJlZi5vblVwZGF0ZSA9IHRoaXMub25Qb3BwZXJVcGRhdGUuYmluZCh0aGlzKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChwb3BwZXJSZWYub25IaWRkZW4uc3Vic2NyaWJlKHRoaXMuaGlkZS5iaW5kKHRoaXMpKSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNjcm9sbFBhcmVudChub2RlKSB7XG4gICAgY29uc3QgaXNFbGVtZW50ID0gbm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50O1xuICAgIGNvbnN0IG92ZXJmbG93WSA9IGlzRWxlbWVudCAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShub2RlKS5vdmVyZmxvd1k7XG4gICAgY29uc3QgaXNTY3JvbGxhYmxlID0gb3ZlcmZsb3dZICE9PSAndmlzaWJsZScgJiYgb3ZlcmZsb3dZICE9PSAnaGlkZGVuJztcblxuICAgIGlmICghbm9kZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChpc1Njcm9sbGFibGUgJiYgbm9kZS5zY3JvbGxIZWlnaHQgPj0gbm9kZS5jbGllbnRIZWlnaHQpIHtcbiAgICAgIHJldHVybiBub2RlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldFNjcm9sbFBhcmVudChub2RlLnBhcmVudE5vZGUpIHx8IGRvY3VtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBvblBvcHBlclVwZGF0ZShldmVudCkge1xuICAgIHRoaXMucG9wcGVyT25VcGRhdGUuZW1pdChldmVudCk7XG4gIH1cblxufVxuIl19