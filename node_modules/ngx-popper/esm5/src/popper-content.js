/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, EventEmitter, HostListener, Renderer2, ViewChild, ViewContainerRef, ViewEncapsulation, } from "@angular/core";
import Popper from 'popper.js';
import { Placements, Triggers } from './popper-model';
var PopperContent = /** @class */ (function () {
    function PopperContent(elemRef, renderer, viewRef, CDR) {
        this.elemRef = elemRef;
        this.renderer = renderer;
        this.viewRef = viewRef;
        this.CDR = CDR;
        this.popperOptions = (/** @type {?} */ ({
            disableAnimation: false,
            disableDefaultStyling: false,
            placement: Placements.Auto,
            boundariesElement: '',
            trigger: Triggers.HOVER,
            positionFixed: false,
            appendToBody: false,
            popperModifiers: {}
        }));
        this.isMouseOver = false;
        this.onHidden = new EventEmitter();
        this.displayType = "none";
        this.opacity = 0;
        this.ariaHidden = 'true';
        this.arrowColor = null;
        this.state = true;
    }
    /**
     * @return {?}
     */
    PopperContent.prototype.onMouseOver = /**
     * @return {?}
     */
    function () {
        this.isMouseOver = true;
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.showOnLeave = /**
     * @return {?}
     */
    function () {
        this.isMouseOver = false;
        if (this.popperOptions.trigger !== Triggers.HOVER && !this.popperOptions.hideOnMouseLeave) {
            return;
        }
        this.hide();
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.onDocumentResize = /**
     * @return {?}
     */
    function () {
        this.update();
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.clean();
        if (this.popperOptions.appendTo && this.elemRef && this.elemRef.nativeElement && this.elemRef.nativeElement.parentNode) {
            this.viewRef.detach();
            this.elemRef.nativeElement.parentNode.removeChild(this.elemRef.nativeElement);
        }
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.clean = /**
     * @return {?}
     */
    function () {
        this.toggleVisibility(false);
        if (!this.popperInstance) {
            return;
        }
        ((/** @type {?} */ (this.popperInstance))).disableEventListeners();
        this.popperInstance.destroy();
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.show = /**
     * @return {?}
     */
    function () {
        if (!this.referenceObject) {
            return;
        }
        /** @type {?} */
        var appendToParent = this.popperOptions.appendTo && document.querySelector(this.popperOptions.appendTo);
        if (appendToParent && this.elemRef.nativeElement.parentNode !== appendToParent) {
            this.elemRef.nativeElement.parentNode && this.elemRef.nativeElement.parentNode.removeChild(this.elemRef.nativeElement);
            appendToParent.appendChild(this.elemRef.nativeElement);
        }
        /** @type {?} */
        var popperOptions = (/** @type {?} */ ({
            placement: this.popperOptions.placement,
            positionFixed: this.popperOptions.positionFixed,
            modifiers: {
                arrow: {
                    element: this.popperViewRef.nativeElement.querySelector('.ngxp__arrow')
                }
            }
        }));
        if (this.onUpdate) {
            popperOptions.onUpdate = (/** @type {?} */ (this.onUpdate));
        }
        /** @type {?} */
        var boundariesElement = this.popperOptions.boundariesElement && document.querySelector(this.popperOptions.boundariesElement);
        if (popperOptions.modifiers && boundariesElement) {
            popperOptions.modifiers.preventOverflow = { boundariesElement: boundariesElement };
        }
        if (popperOptions.modifiers && this.popperOptions.preventOverflow !== undefined) {
            popperOptions.modifiers.preventOverflow = popperOptions.modifiers.preventOverflow || {};
            popperOptions.modifiers.preventOverflow.enabled = this.popperOptions.preventOverflow;
            if (!popperOptions.modifiers.preventOverflow.enabled) {
                popperOptions.modifiers.hide = { enabled: false };
            }
        }
        this.determineArrowColor();
        popperOptions.modifiers = Object.assign(popperOptions.modifiers, this.popperOptions.popperModifiers);
        this.popperInstance = new Popper(this.referenceObject, this.popperViewRef.nativeElement, popperOptions);
        ((/** @type {?} */ (this.popperInstance))).enableEventListeners();
        this.scheduleUpdate();
        this.toggleVisibility(true);
        this.globalResize = this.renderer.listen('document', 'resize', this.onDocumentResize.bind(this));
    };
    /**
     * @private
     * @return {?}
     */
    PopperContent.prototype.determineArrowColor = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        ['background-color', 'backgroundColor'].some(function (clr) {
            if (!_this.popperOptions.styles) {
                return false;
            }
            if (_this.popperOptions.styles.hasOwnProperty(clr)) {
                _this.arrowColor = _this.popperOptions.styles[clr];
                return true;
            }
            return false;
        });
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.update = /**
     * @return {?}
     */
    function () {
        this.popperInstance && ((/** @type {?} */ (this.popperInstance))).update();
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.scheduleUpdate = /**
     * @return {?}
     */
    function () {
        this.popperInstance && ((/** @type {?} */ (this.popperInstance))).scheduleUpdate();
    };
    /**
     * @return {?}
     */
    PopperContent.prototype.hide = /**
     * @return {?}
     */
    function () {
        if (this.popperInstance) {
            this.popperInstance.destroy();
        }
        this.toggleVisibility(false);
        this.onHidden.emit();
    };
    /**
     * @param {?} state
     * @return {?}
     */
    PopperContent.prototype.toggleVisibility = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        if (!state) {
            this.opacity = 0;
            this.displayType = "none";
            this.ariaHidden = 'true';
            this.state = false;
        }
        else {
            this.opacity = 1;
            this.displayType = "block";
            this.ariaHidden = 'false';
            this.state = true;
        }
        if (!this.CDR['destroyed']) {
            this.CDR.detectChanges();
        }
    };
    /**
     * @param {?=} classList
     * @return {?}
     */
    PopperContent.prototype.extractAppliedClassListExpr = /**
     * @param {?=} classList
     * @return {?}
     */
    function (classList) {
        if (!classList || typeof classList !== 'string') {
            return null;
        }
        try {
            return classList
                .replace(/ /, '')
                .split(',')
                .reduce(function (acc, clss) {
                acc[clss] = true;
                return acc;
            }, {});
        }
        catch (e) {
            return null;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PopperContent.prototype.clearGlobalResize = /**
     * @private
     * @return {?}
     */
    function () {
        this.globalResize && typeof this.globalResize === 'function' && this.globalResize();
    };
    PopperContent.decorators = [
        { type: Component, args: [{
                    selector: "popper-content",
                    encapsulation: ViewEncapsulation.None,
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    template: "\n    <div #popperViewRef\n         [class.ngxp__container]=\"!popperOptions.disableDefaultStyling\"\n         [class.ngxp__animation]=\"!popperOptions.disableAnimation\"\n         [style.display]=\"displayType\"\n         [style.opacity]=\"opacity\"\n         [ngStyle]=\"popperOptions.styles\"\n         [ngClass]=\"extractAppliedClassListExpr(popperOptions.applyClass)\"\n         attr.aria-hidden=\"{{ariaHidden}}\"\n         [attr.aria-describedby]=\"popperOptions.ariaDescribe || null\"\n         attr.role=\"{{popperOptions.ariaRole}}\">\n      <div class=\"ngxp__inner\" *ngIf=\"text\" [innerHTML]=\"text\">\n        <ng-content></ng-content>\n      </div>\n      <div class=\"ngxp__inner\" *ngIf=\"!text\">\n        <ng-content></ng-content>\n      </div>\n      <div class=\"ngxp__arrow\" [style.border-color]=\"arrowColor\" [class.__force-arrow]=\"arrowColor\"\n           [ngClass]=\"extractAppliedClassListExpr(popperOptions.applyArrowClass)\"></div>\n\n    </div>\n  ",
                    styles: [".ngxp__container{display:none;position:absolute;border-radius:3px;border:1px solid grey;box-shadow:0 0 2px rgba(0,0,0,.5);padding:10px}.ngxp__container.ngxp__animation{-webkit-animation:150ms ease-out ngxp-fadeIn;animation:150ms ease-out ngxp-fadeIn}.ngxp__container>.ngxp__arrow{border-color:grey;width:0;height:0;border-style:solid;position:absolute;margin:5px}.ngxp__container[x-placement^=bottom],.ngxp__container[x-placement^=left],.ngxp__container[x-placement^=right],.ngxp__container[x-placement^=top]{display:block}.ngxp__container[x-placement^=top]{margin-bottom:5px}.ngxp__container[x-placement^=top]>.ngxp__arrow{border-width:5px 5px 0;border-right-color:transparent;border-bottom-color:transparent;border-left-color:transparent;bottom:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.ngxp__container[x-placement^=top]>.ngxp__arrow.__force-arrow{border-right-color:transparent!important;border-bottom-color:transparent!important;border-left-color:transparent!important}.ngxp__container[x-placement^=bottom]{margin-top:5px}.ngxp__container[x-placement^=bottom]>.ngxp__arrow{border-width:0 5px 5px;border-top-color:transparent;border-right-color:transparent;border-left-color:transparent;top:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.ngxp__container[x-placement^=bottom]>.ngxp__arrow.__force-arrow{border-top-color:transparent!important;border-right-color:transparent!important;border-left-color:transparent!important}.ngxp__container[x-placement^=right]{margin-left:5px}.ngxp__container[x-placement^=right]>.ngxp__arrow{border-width:5px 5px 5px 0;border-top-color:transparent;border-bottom-color:transparent;border-left-color:transparent;left:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.ngxp__container[x-placement^=right]>.ngxp__arrow.__force-arrow{border-top-color:transparent!important;border-bottom-color:transparent!important;border-left-color:transparent!important}.ngxp__container[x-placement^=left]{margin-right:5px}.ngxp__container[x-placement^=left]>.ngxp__arrow{border-width:5px 0 5px 5px;border-top-color:transparent;border-bottom-color:transparent;border-right-color:transparent;right:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.ngxp__container[x-placement^=left]>.ngxp__arrow.__force-arrow{border-top-color:transparent!important;border-bottom-color:transparent!important;border-right-color:transparent!important}@-webkit-keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}@keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}100%{display:block;opacity:1}}"]
                }] }
    ];
    /** @nocollapse */
    PopperContent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: ViewContainerRef },
        { type: ChangeDetectorRef }
    ]; };
    PopperContent.propDecorators = {
        popperViewRef: [{ type: ViewChild, args: ["popperViewRef",] }],
        onMouseOver: [{ type: HostListener, args: ['mouseover',] }],
        showOnLeave: [{ type: HostListener, args: ['mouseleave',] }]
    };
    return PopperContent;
}());
export { PopperContent };
if (false) {
    /** @type {?} */
    PopperContent.prototype.popperOptions;
    /** @type {?} */
    PopperContent.prototype.referenceObject;
    /** @type {?} */
    PopperContent.prototype.isMouseOver;
    /** @type {?} */
    PopperContent.prototype.onHidden;
    /** @type {?} */
    PopperContent.prototype.text;
    /** @type {?} */
    PopperContent.prototype.popperInstance;
    /** @type {?} */
    PopperContent.prototype.displayType;
    /** @type {?} */
    PopperContent.prototype.opacity;
    /** @type {?} */
    PopperContent.prototype.ariaHidden;
    /** @type {?} */
    PopperContent.prototype.arrowColor;
    /** @type {?} */
    PopperContent.prototype.onUpdate;
    /** @type {?} */
    PopperContent.prototype.state;
    /**
     * @type {?}
     * @private
     */
    PopperContent.prototype.globalResize;
    /** @type {?} */
    PopperContent.prototype.popperViewRef;
    /** @type {?} */
    PopperContent.prototype.elemRef;
    /**
     * @type {?}
     * @private
     */
    PopperContent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PopperContent.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    PopperContent.prototype.CDR;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wcGVyLWNvbnRlbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcG9wcGVyLyIsInNvdXJjZXMiOlsic3JjL3BvcHBlci1jb250ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQUUsaUJBQWlCLEVBQzFDLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFlBQVksRUFFWixTQUFTLEVBQ1QsU0FBUyxFQUNULGdCQUFnQixFQUNoQixpQkFBaUIsR0FDbEIsTUFBTSxlQUFlLENBQUE7QUFDdEIsT0FBTyxNQUFNLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxVQUFVLEVBQXdCLFFBQVEsRUFBQyxNQUFNLGdCQUFnQixDQUFBO0FBRXpFO0lBc0ZFLHVCQUNTLE9BQW1CLEVBQ2xCLFFBQW1CLEVBQ25CLE9BQXlCLEVBQ3pCLEdBQXNCO1FBSHZCLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUN6QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQTVEaEMsa0JBQWEsR0FBeUIsbUJBQXNCO1lBQzFELGdCQUFnQixFQUFFLEtBQUs7WUFDdkIscUJBQXFCLEVBQUUsS0FBSztZQUM1QixTQUFTLEVBQUUsVUFBVSxDQUFDLElBQUk7WUFDMUIsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsUUFBUSxDQUFDLEtBQUs7WUFDdkIsYUFBYSxFQUFFLEtBQUs7WUFDcEIsWUFBWSxFQUFFLEtBQUs7WUFDbkIsZUFBZSxFQUFFLEVBQUU7U0FDcEIsRUFBQSxDQUFDO1FBSUYsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFFN0IsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFNOUIsZ0JBQVcsR0FBVyxNQUFNLENBQUM7UUFFN0IsWUFBTyxHQUFXLENBQUMsQ0FBQztRQUVwQixlQUFVLEdBQVcsTUFBTSxD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QXpCO1FBQ0UsSUFBSSxDQUFDLFlBQVksSUFBSSxPQUFPLElBQUksQ0FBQyxZQUFZLEtBQUssVUFBVSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0RixDQUFDOztnQkF0T0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxnQkFBZ0I7b0JBQzFCLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO29CQUNyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtvQkFDL0MsUUFBUSxFQUFFLHU5QkFxQlQ7O2lCQUVGOzs7O2dCQXZDQyxVQUFVO2dCQUlWLFNBQVM7Z0JBRVQsZ0JBQWdCO2dCQVJTLGlCQUFpQjs7O2dDQStFekMsU0FBUyxTQUFDLGVBQWU7OEJBR3pCLFlBQVksU0FBQyxXQUFXOzhCQUt4QixZQUFZLFNBQUMsWUFBWTs7SUErSjVCLG9CQUFDO0NBQUEsQUF4T0QsSUF3T0M7U0E1TVksYUFBYTs7O0lBRXhCLHNDQVNFOztJQUVGLHdDQUE2Qjs7SUFFN0Isb0NBQTZCOztJQUU3QixpQ0FBOEI7O0lBRTlCLDZCQUFhOztJQUViLHVDQUF1Qjs7SUFFdkIsb0NBQTZCOztJQUU3QixnQ0FBb0I7O0lBRXBCLG1DQUE0Qjs7SUFFNUIsbUNBQWlDOztJQUVqQyxpQ0FBbUI7O0lBRW5CLDhCQUFzQjs7Ozs7SUFFdEIscUNBQTBCOztJQUUxQixzQ0FDMEI7O0lBcUJ4QixnQ0FBMEI7Ozs7O0lBQzFCLGlDQUEyQjs7Ozs7SUFDM0IsZ0NBQWlDOzs7OztJQUNqQyw0QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0TGlzdGVuZXIsXG4gIE9uRGVzdHJveSxcbiAgUmVuZGVyZXIyLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiXG5pbXBvcnQgUG9wcGVyIGZyb20gJ3BvcHBlci5qcydcbmltcG9ydCB7UGxhY2VtZW50cywgUG9wcGVyQ29udGVudE9wdGlvbnMsIFRyaWdnZXJzfSBmcm9tICcuL3BvcHBlci1tb2RlbCdcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcInBvcHBlci1jb250ZW50XCIsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxkaXYgI3BvcHBlclZpZXdSZWZcbiAgICAgICAgIFtjbGFzcy5uZ3hwX19jb250YWluZXJdPVwiIXBvcHBlck9wdGlvbnMuZGlzYWJsZURlZmF1bHRTdHlsaW5nXCJcbiAgICAgICAgIFtjbGFzcy5uZ3hwX19hbmltYXRpb25dPVwiIXBvcHBlck9wdGlvbnMuZGlzYWJsZUFuaW1hdGlvblwiXG4gICAgICAgICBbc3R5bGUuZGlzcGxheV09XCJkaXNwbGF5VHlwZVwiXG4gICAgICAgICBbc3R5bGUub3BhY2l0eV09XCJvcGFjaXR5XCJcbiAgICAgICAgIFtuZ1N0eWxlXT1cInBvcHBlck9wdGlvbnMuc3R5bGVzXCJcbiAgICAgICAgIFtuZ0NsYXNzXT1cImV4dHJhY3RBcHBsaWVkQ2xhc3NMaXN0RXhwcihwb3BwZXJPcHRpb25zLmFwcGx5Q2xhc3MpXCJcbiAgICAgICAgIGF0dHIuYXJpYS1oaWRkZW49XCJ7e2FyaWFIaWRkZW59fVwiXG4gICAgICAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cInBvcHBlck9wdGlvbnMuYXJpYURlc2NyaWJlIHx8IG51bGxcIlxuICAgICAgICAgYXR0ci5yb2xlPVwie3twb3BwZXJPcHRpb25zLmFyaWFSb2xlfX1cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJuZ3hwX19pbm5lclwiICpuZ0lmPVwidGV4dFwiIFtpbm5lckhUTUxdPVwidGV4dFwiPlxuICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJuZ3hwX19pbm5lclwiICpuZ0lmPVwiIXRleHRcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwibmd4cF9fYXJyb3dcIiBbc3R5bGUuYm9yZGVyLWNvbG9yXT1cImFycm93Q29sb3JcIiBbY2xhc3MuX19mb3JjZS1hcnJvd109XCJhcnJvd0NvbG9yXCJcbiAgICAgICAgICAgW25nQ2xhc3NdPVwiZXh0cmFjdEFwcGxpZWRDbGFzc0xpc3RFeHByKHBvcHBlck9wdGlvbnMuYXBwbHlBcnJvd0NsYXNzKVwiPjwvZGl2PlxuXG4gICAgPC9kaXY+XG4gIGAsXG4gIHN0eWxlVXJsczogWycuL3BvcHBlci1jb250ZW50LmNzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBQb3BwZXJDb250ZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcblxuICBwb3BwZXJPcHRpb25zOiBQb3BwZXJDb250ZW50T3B0aW9ucyA9IDxQb3BwZXJDb250ZW50T3B0aW9ucz57XG4gICAgZGlzYWJsZUFuaW1hdGlvbjogZmFsc2UsXG4gICAgZGlzYWJsZURlZmF1bHRTdHlsaW5nOiBmYWxzZSxcbiAgICBwbGFjZW1lbnQ6IFBsYWNlbWVudHMuQXV0byxcbiAgICBib3VuZGFyaWVzRWxlbWVudDogJycsXG4gICAgdHJpZ2dlcjogVHJpZ2dlcnMuSE9WRVIsXG4gICAgcG9zaXRpb25GaXhlZDogZmFsc2UsXG4gICAgYXBwZW5kVG9Cb2R5OiBmYWxzZSxcbiAgICBwb3BwZXJNb2RpZmllcnM6IHt9XG4gIH07XG5cbiAgcmVmZXJlbmNlT2JqZWN0OiBIVE1MRWxlbWVudDtcblxuICBpc01vdXNlT3ZlcjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIG9uSGlkZGVuID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHRleHQ6IHN0cmluZztcblxuICBwb3BwZXJJbnN0YW5jZTogUG9wcGVyO1xuXG4gIGRpc3BsYXlUeXBlOiBzdHJpbmcgPSBcIm5vbmVcIjtcblxuICBvcGFjaXR5OiBudW1iZXIgPSAwO1xuXG4gIGFyaWFIaWRkZW46IHN0cmluZyA9ICd0cnVlJztcblxuICBhcnJvd0NvbG9yOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICBvblVwZGF0ZTogRnVuY3Rpb247XG5cbiAgc3RhdGU6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIHByaXZhdGUgZ2xvYmFsUmVzaXplOiBhbnk7XG5cbiAgQFZpZXdDaGlsZChcInBvcHBlclZpZXdSZWZcIilcbiAgcG9wcGVyVmlld1JlZjogRWxlbWVudFJlZjtcblxuICBASG9zdExpc3RlbmVyKCdtb3VzZW92ZXInKVxuICBvbk1vdXNlT3ZlcigpIHtcbiAgICB0aGlzLmlzTW91c2VPdmVyID0gdHJ1ZTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ21vdXNlbGVhdmUnKVxuICBzaG93T25MZWF2ZSgpIHtcbiAgICB0aGlzLmlzTW91c2VPdmVyID0gZmFsc2U7XG4gICAgaWYgKHRoaXMucG9wcGVyT3B0aW9ucy50cmlnZ2VyICE9PSBUcmlnZ2Vycy5IT1ZFUiAmJiAhdGhpcy5wb3BwZXJPcHRpb25zLmhpZGVPbk1vdXNlTGVhdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5oaWRlKCk7XG4gIH1cblxuICBvbkRvY3VtZW50UmVzaXplKCkge1xuICAgIHRoaXMudXBkYXRlKCk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgZWxlbVJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSB2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgQ0RSOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5jbGVhbigpO1xuICAgIGlmKHRoaXMucG9wcGVyT3B0aW9ucy5hcHBlbmRUbyAmJiB0aGlzLmVsZW1SZWYgJiYgdGhpcy5lbGVtUmVmLm5hdGl2ZUVsZW1lbnQgJiYgdGhpcy5lbGVtUmVmLm5hdGl2ZUVsZW1lbnQucGFyZW50Tm9kZSl7XG4gICAgICB0aGlzLnZpZXdSZWYuZGV0YWNoKCk7XG4gICAgICB0aGlzLmVsZW1SZWYubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbVJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBjbGVhbigpIHtcbiAgICB0aGlzLnRvZ2dsZVZpc2liaWxpdHkoZmFsc2UpO1xuICAgIGlmICghdGhpcy5wb3BwZXJJbnN0YW5jZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAodGhpcy5wb3BwZXJJbnN0YW5jZSBhcyBhbnkpLmRpc2FibGVFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMucG9wcGVySW5zdGFuY2UuZGVzdHJveSgpO1xuXG4gIH1cblxuICBzaG93KCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5yZWZlcmVuY2VPYmplY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhcHBlbmRUb1BhcmVudCA9IHRoaXMucG9wcGVyT3B0aW9ucy5hcHBlbmRUbyAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucG9wcGVyT3B0aW9ucy5hcHBlbmRUbyk7XG4gICAgaWYgKGFwcGVuZFRvUGFyZW50ICYmIHRoaXMuZWxlbVJlZi5uYXRpdmVFbGVtZW50LnBhcmVudE5vZGUgIT09IGFwcGVuZFRvUGFyZW50KSB7XG4gICAgICB0aGlzLmVsZW1SZWYubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlICYmIHRoaXMuZWxlbVJlZi5uYXRpdmVFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbGVtUmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgYXBwZW5kVG9QYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtUmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgIH1cblxuICAgIGxldCBwb3BwZXJPcHRpb25zOiBQb3BwZXIuUG9wcGVyT3B0aW9ucyA9IDxQb3BwZXIuUG9wcGVyT3B0aW9ucz57XG4gICAgICBwbGFjZW1lbnQ6IHRoaXMucG9wcGVyT3B0aW9ucy5wbGFjZW1lbnQsXG4gICAgICBwb3NpdGlvbkZpeGVkOiB0aGlzLnBvcHBlck9wdGlvbnMucG9zaXRpb25GaXhlZCxcbiAgICAgIG1vZGlmaWVyczoge1xuICAgICAgICBhcnJvdzoge1xuICAgICAgICAgIGVsZW1lbnQ6IHRoaXMucG9wcGVyVmlld1JlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZ3hwX19hcnJvdycpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICh0aGlzLm9uVXBkYXRlKSB7XG4gICAgICBwb3BwZXJPcHRpb25zLm9uVXBkYXRlID0gdGhpcy5vblVwZGF0ZSBhcyBhbnk7XG4gICAgfVxuXG4gICAgbGV0IGJvdW5kYXJpZXNFbGVtZW50ID0gdGhpcy5wb3BwZXJPcHRpb25zLmJvdW5kYXJpZXNFbGVtZW50ICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wb3BwZXJPcHRpb25zLmJvdW5kYXJpZXNFbGVtZW50KTtcblxuICAgIGlmIChwb3BwZXJPcHRpb25zLm1vZGlmaWVycyAmJiBib3VuZGFyaWVzRWxlbWVudCkge1xuICAgICAgcG9wcGVyT3B0aW9ucy5tb2RpZmllcnMucHJldmVudE92ZXJmbG93ID0ge2JvdW5kYXJpZXNFbGVtZW50fTtcbiAgICB9XG4gICAgaWYgKHBvcHBlck9wdGlvbnMubW9kaWZpZXJzICYmIHRoaXMucG9wcGVyT3B0aW9ucy5wcmV2ZW50T3ZlcmZsb3cgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcG9wcGVyT3B0aW9ucy5tb2RpZmllcnMucHJldmVudE92ZXJmbG93ID0gcG9wcGVyT3B0aW9ucy5tb2RpZmllcnMucHJldmVudE92ZXJmbG93IHx8IHt9O1xuICAgICAgcG9wcGVyT3B0aW9ucy5tb2RpZmllcnMucHJldmVudE92ZXJmbG93LmVuYWJsZWQgPSB0aGlzLnBvcHBlck9wdGlvbnMucHJldmVudE92ZXJmbG93O1xuICAgICAgaWYgKCFwb3BwZXJPcHRpb25zLm1vZGlmaWVycy5wcmV2ZW50T3ZlcmZsb3cuZW5hYmxlZCkge1xuICAgICAgICBwb3BwZXJPcHRpb25zLm1vZGlmaWVycy5oaWRlID0ge2VuYWJsZWQ6IGZhbHNlfTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZXRlcm1pbmVBcnJvd0NvbG9yKCk7XG4gICAgcG9wcGVyT3B0aW9ucy5tb2RpZmllcnMgPSBPYmplY3QuYXNzaWduKHBvcHBlck9wdGlvbnMubW9kaWZpZXJzLCB0aGlzLnBvcHBlck9wdGlvbnMucG9wcGVyTW9kaWZpZXJzKTtcblxuICAgIHRoaXMucG9wcGVySW5zdGFuY2UgPSBuZXcgUG9wcGVyKFxuICAgICAgdGhpcy5yZWZlcmVuY2VPYmplY3QsXG4gICAgICB0aGlzLnBvcHBlclZpZXdSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgIHBvcHBlck9wdGlvbnMsXG4gICAgKTtcblxuICAgICh0aGlzLnBvcHBlckluc3RhbmNlIGFzIGFueSkuZW5hYmxlRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLnNjaGVkdWxlVXBkYXRlKCk7XG4gICAgdGhpcy50b2dnbGVWaXNpYmlsaXR5KHRydWUpO1xuICAgIHRoaXMuZ2xvYmFsUmVzaXplID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ3Jlc2l6ZScsIHRoaXMub25Eb2N1bWVudFJlc2l6ZS5iaW5kKHRoaXMpKVxuICB9XG5cbiAgcHJpdmF0ZSBkZXRlcm1pbmVBcnJvd0NvbG9yKCkge1xuICAgIFsnYmFja2dyb3VuZC1jb2xvcicsICdiYWNrZ3JvdW5kQ29sb3InXS5zb21lKChjbHIpID0+IHtcbiAgICAgIGlmICghdGhpcy5wb3BwZXJPcHRpb25zLnN0eWxlcykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wb3BwZXJPcHRpb25zLnN0eWxlcy5oYXNPd25Qcm9wZXJ0eShjbHIpKSB7XG4gICAgICAgIHRoaXMuYXJyb3dDb2xvciA9IHRoaXMucG9wcGVyT3B0aW9ucy5zdHlsZXNbY2xyXTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSlcbiAgfVxuXG4gIHVwZGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnBvcHBlckluc3RhbmNlICYmICh0aGlzLnBvcHBlckluc3RhbmNlIGFzIGFueSkudXBkYXRlKCk7XG4gIH1cblxuICBzY2hlZHVsZVVwZGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnBvcHBlckluc3RhbmNlICYmICh0aGlzLnBvcHBlckluc3RhbmNlIGFzIGFueSkuc2NoZWR1bGVVcGRhdGUoKTtcbiAgfVxuXG4gIGhpZGUoKTogdm9pZCB7XG5cbiAgICBpZiAodGhpcy5wb3BwZXJJbnN0YW5jZSkge1xuICAgICAgdGhpcy5wb3BwZXJJbnN0YW5jZS5kZXN0cm95KCk7XG4gICAgfVxuICAgIHRoaXMudG9nZ2xlVmlzaWJpbGl0eShmYWxzZSk7XG4gICAgdGhpcy5vbkhpZGRlbi5lbWl0KCk7XG4gIH1cblxuICB0b2dnbGVWaXNpYmlsaXR5KHN0YXRlOiBib29sZWFuKSB7XG4gICAgaWYgKCFzdGF0ZSkge1xuICAgICAgdGhpcy5vcGFjaXR5ID0gMDtcbiAgICAgIHRoaXMuZGlzcGxheVR5cGUgPSBcIm5vbmVcIjtcbiAgICAgIHRoaXMuYXJpYUhpZGRlbiA9ICd0cnVlJztcbiAgICAgIHRoaXMuc3RhdGUgPSBmYWxzZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLm9wYWNpdHkgPSAxO1xuICAgICAgdGhpcy5kaXNwbGF5VHlwZSA9IFwiYmxvY2tcIjtcbiAgICAgIHRoaXMuYXJpYUhpZGRlbiA9ICdmYWxzZSc7XG4gICAgICB0aGlzLnN0YXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLkNEUlsnZGVzdHJveWVkJ10pIHtcbiAgICAgIHRoaXMuQ0RSLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxuICBleHRyYWN0QXBwbGllZENsYXNzTGlzdEV4cHIoY2xhc3NMaXN0Pzogc3RyaW5nKTogT2JqZWN0IHwgbnVsbCB7XG4gICAgaWYgKCFjbGFzc0xpc3QgfHwgdHlwZW9mIGNsYXNzTGlzdCAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGNsYXNzTGlzdFxuICAgICAgICAucmVwbGFjZSgvIC8sICcnKVxuICAgICAgICAuc3BsaXQoJywnKVxuICAgICAgICAucmVkdWNlKChhY2MsIGNsc3MpID0+IHtcbiAgICAgICAgICBhY2NbY2xzc10gPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9KVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjbGVhckdsb2JhbFJlc2l6ZSgpIHtcbiAgICB0aGlzLmdsb2JhbFJlc2l6ZSAmJiB0eXBlb2YgdGhpcy5nbG9iYWxSZXNpemUgPT09ICdmdW5jdGlvbicgJiYgdGhpcy5nbG9iYWxSZXNpemUoKTtcbiAgfVxuXG59XG4iXX0=